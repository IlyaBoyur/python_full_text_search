# Full Text Search App in Python

Реляционные БД не подходят для поиска:
- Не предназначены для массовых операций чтения над ними из-за их архитектуры.
- Требуют аккуратной работы при поиске по данным. Необходимо построить индексы, проверить запросы — любая ошибка условий в запросах будет сильно замедлять их.
- Такой поиск будет лишен нечёткого поиска, поиска синонимов и стоп-слов, автодополнения, поддержки нескольких языков
- PostgreSQL требует вдумчивого создания индексов и умения оптимизировать запросы, чтобы получить наибольшую производительность.
- PostgreSQL плохо масштабируется на запись. Выход из строя master-сервера сразу же рушит всю систему. Вы не сможете добавлять новые объекты, но поиск будет работать. Реплики в этом случае не помогут.

Сервис полнотекстового поиска:
- должен выдерживать высокую нагрузку от пользователей
- обладать гибкими настройками поиска по документам 
- сохранять при этом приемлемое время ответа

поэтому нужно использовать специализированные БД — _поисковые движки_.

**Elasticsearch** выгодно отличается от других поисковых движков:  
Плюсы:  
- Относительная простота установки: готовый docker-образ
- Масштабирование: реплики, шарды, кластер серверов (до 2-3 млн RPS на запись)
- Поисковый движок Apache Lucene: полнотекстовый поиск, нечеткий поиск
- Интерфейс RESTful API
Минусы:  
- Ресурсы (из-за JVM)
- Недостаток безопасности
- Поломки при переходе между мажорными версиями


## Быстрый старт
### 1. Поднять Elasticsearch + Kibana
```bash
docker compose up -d --remove-orphans
```

### 2. Elasticsearch SQL CLI
```bash
docker compose exec -it elasticsearch elasticsearch-sql-cli
```

### 3. Dev Tools  
Вбить в поисковую строку браузера:  
```http://localhost:5601/app/dev_tools#/console```


### Сервис полнотекстового поиска включает
- БД SQLite c legacy данными
- ETL-скрипт (Extract, transform, load), который отвечает за миграцию данных SQLite -> Elasticsearch.
- эндпоинты API на Flask


### Документация API

- Получение списка всех видеофайлов, которые есть в БД:
```
/api/v1/video/collection?limit=50&page=int&search=str&sort=str&sort_order=str

// search — поиск с учётом морфологии по атрибутам фильма
(название, описание, режиссёр и т.д.).
// limit — количество элементов в выдаче.
// page — страница в выдаче.
// sort — сортировка по определённому полю.
// sort_order — направление сортировки.
```

- Получение карточки одного конкретного видеофайла:
```
/api/v1/video/get/<id:str>
```

- Получение информации о клиенте:
```
/client/info
```
